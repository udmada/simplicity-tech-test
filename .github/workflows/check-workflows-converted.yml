# Do not modify!
# This file was generated from a template using https://github.com/StefMa/pkl-gha

name: Check Pkl Workflows Converted
'on':
  pull_request:
    paths:
    - .github/pkl-workflows/**
    - .github/workflows/**
  push:
    branches:
    - master
    paths:
    - .github/pkl-workflows/**
    - .github/workflows/**
jobs:
  check-converted:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Install mise
      uses: jdx/mise-action@v2
    - name: Convert pkl workflows to yaml
      run: pkl eval .github/pkl-workflows/*.pkl -o ".github/workflows/%{moduleName}.yml"
    - name: Verify if pkl actions are converted
      run: |-
        if ! git diff --exit-code .github/workflows/; then
          echo "❌ Error: Pkl workflows are not converted to YAML!"
          echo ""
          echo "Run:"
          echo "  pkl eval .github/pkl-workflows/*.pkl -o .github/workflows/%{moduleName}.yml"
          exit 1
        fi
        echo "✅ All pkl workflows are properly converted to YAML"
